# 🧠 TaskTracker — Domain Layer

**TaskTracker** — это система управления задачами с поддержкой командной работы, ролевой модели доступа и событийной архитектуры. Данный модуль описывает **доменную модель** и **бизнес-правила** системы, реализованные по принципам **DDD (Domain-Driven Design)** и **Clean Architecture**.

---

## 🧩 Основные сущности

---

### 👤 User (Пользователь)

- Представляет пользователя системы
- **Атрибуты:**
  - `Name` — имя пользователя
  - `Email` — электронная почта
  - `PasswordHash` — хэш пароля
  - `Role` — роль (`User`, `Manager`, `Admin`)
  - `TeamId` — идентификатор команды
  - `CreatedAt` — дата создания

- **Ограничения:**
  - Нельзя создать с ролью `Admin`
  - Может состоять только в одной команде
  - Не может самостоятельно удалять задачи

- **Связанные сущности:**
  - `TaskComments` — комментарии, оставленные пользователем
  - `TaskParticipant` — участие в задачах

- **Генерируемые события:**
  - `CreateUserEvent`
  - `UserLeftTeamEvent`
  - `AddMembersOfTeamsEvent`

- **Методы:**
  - `Create(...)` — создание пользователя
  - `AddTeam(teamId)` — присоединение к команде
  - `LeaveTeam()` — выход из команды
  - `Delete()` — удаление пользователя

---

### 👥 Team (Команда)

- Представляет группу пользователей, объединённых в рамках задач
- **Атрибуты:**
  - `Name` — название команды
  - `AdminId` — идентификатор менеджера (создателя)
  - `TeamPassword` — пароль для вступления в команду
  - `CreatedAt` — дата создания
  - `Members` — участники команды

- **Ограничения:**
  - Только `Manager` может создать команду
  - Удаление администратора запрещено
  - Пароль обязателен для вступления

- **Генерируемые события:**
  - `UserRemovedFromTeamEvent`
  - `AddMembersOfTeamsEvent`

- **Методы:**
  - `Create(...)` — создание новой команды
  - `AddMember(user, password)` — добавление участника
  - `RemoveMember(user)` — удаление участника
  - `IsMember(userId)` — проверка членства пользователя

---

### 👨‍💼 Manager (Менеджер)

- Представляет менеджера команды и владельца задач
- **Атрибуты:**
  - `UserId` — ссылка на пользователя
  - `TeamId` — управляемая команда
  - `Tasks` — список задач, созданных менеджером

- **Ограничения:**
  - Менеджер не может вступать в другую команду
  - Только менеджер может управлять задачами

- **Генерируемые события:**
  - `ManagerCreatedEvent`

- **Методы:**
  - `Create(...)` — создание менеджера
  - `CreateTask(...)` — создание новой задачи
  - `AssignTask(...)` — назначение пользователя на задачу
  - `DeleteTask(...)` — удаление задачи из команды
  - `RemoveMemberFromTeam(...)` — удаление пользователя

---

### ✅ Task (Задача)

- Основная рабочая единица системы
- **Атрибуты:**
  - `Title` — заголовок задачи
  - `Description` — описание задачи
  - `Status` — статус (`News`, `InProgress`, `Completed`)
  - `CreatedAt` — дата создания
  - `TeamId` — команда-владелец
  - `UserId` — ID менеджера, создавшего задачу

- **Связанные сущности:**
  - `TaskComment` — комментарии к задаче
  - `TaskParticipant` — участники задачи

- **Ограничения:**
  - Только `Manager` может создать и удалить задачу
  - Назначать можно только пользователей команды
  - Максимум 10 комментариев на задачу
  - Нельзя назначать задачи завершённым

- **Методы:**
  - `AddComment(user, comment)` — добавление комментария
  - `AssignTo(user, team)` — назначение пользователя
  - `RemoveParticipant(userId)` — удаление участника

---

## ⚙️ Поведение и бизнес-правила

### 🔐 Безопасность

- Прямое создание пользователей с ролью `Admin` запрещено
- Менеджер не может вступать в другие команды
- Удаление администратора запрещено
- Только менеджер может управлять задачами

---

### 👥 Работа с командами

- Только `Manager` может создавать команду
- Пароль обязателен для вступления
- Участник может быть только в одной команде
- Менеджер может удалять других участников

---

### 📌 Работа с задачами

- Только `Manager` создает и управляет задачами
- Пользователь может участвовать в задачах и оставлять комментарии
- Статусы задач меняются по workflow
- Нельзя добавлять больше 10 комментариев
- Задача закреплена за командой, даже если создатель выходит

---

## 📦 Domain Events (События)

- `CreateUserEvent` — при создании пользователя
- `AddMembersOfTeamsEvent` — при присоединении к команде
- `ManagerCreatedEvent` — при создании менеджера
- `UserRemovedFromTeamEvent` — при удалении участника
- `TaskCreatedEvent` — при создании задачи *(планируется)*
- `TaskAssignedEvent` — при назначении пользователя *(планируется)*

---

## ✅ Тестирование

- **Покрытие методом Unit-тестами:**
  - Создание/удаление пользователей
  - Присоединение/выход из команды
  - Создание команды/задачи менеджером
  - Назначение участников
  - Ограничения по ролям и действиям
  - Валидация бизнес-правил

---

## 🛠️ Архитектура и принципы

- **Архитектура**: Clean Architecture / DDD
- **Паттерны**: Aggregate Root, Domain Events, Entities, Value Objects
- **Принципы**:
  - SRP / SOLID
  - Разделение ответственности
  - Инкапсуляция бизнес-логики
  - Слабая связность между слоями

---

## 📌 Исключения

Кастомные исключения для обработки бизнес-ошибок:

- `NoPermissionException` — нет прав на выполнение действия
- `UserAlreadyExistsException` — пользователь уже в команде
- `IncorrectPasswordException` — неверный пароль при входе
- `CommentOverflowException` — превышен лимит комментариев

---

## 🧭 Дорожная карта

- [ ] Хеширование паролей
- [ ] Поддержка истории изменений задач
- [ ] Уведомления через микросервис
- [ ] Расширенная система ролей (TeamLead, Reviewer)
- [ ] Статистика выполнения задач у менеджера
- [ ] Интеграция с UI (Blazor/React)
- [ ] Экспорт задач / отчёты

---

## ✍️ Автор

> Учебный проект для практики проектирования на .NET с использованием **чистой архитектуры**, **DDD**, **SOLID** и событийной модели.  
> Создан для изучения реальных паттернов построения масштабируемых приложений.

---