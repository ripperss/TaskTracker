# 🚀 TaskTracker Domain Layer

Доменный слой системы управления задачами с поддержкой командной работы.

## 🧩 Основные сущности

### 👤 User (Пользователь)

- Представляет пользователя системы
- Атрибуты:
  - `Name` - имя пользователя
  - `Email` - электронная почта
  - `PasswordHash` - хэш пароля
  - `Role` - роль (`User`, `Manager`, `Admin`)
  - `TeamId` - идентификатор команды
  - `CreatedAt` - дата создания
- Ограничения:
  - Нельзя создать с ролью `Admin`
  - Может состоять только в одной команде
- Связанные сущности:
  - `Tasks` - созданные задачи
  - `TaskComments` - оставленные комментарии
  - `TaskParticipant` - участие в задачах
- Генерируемые события:
  - `CreateUserEvent` - при создании
  - `UserLeftTeamEvent` - при выходе из команды
  - `AddMembersOfTeamsEvent` - при добавлении в команду

Методы:
- `Create(email, passwordHash, name, role)` - создание пользователя
- `AddTeam(teamId, password)` - присоединение к команде
- `LeaveTeam()` - выход из команды

---

### 👥 Team (Команда)

- Представляет группу пользователей
- Атрибуты:
  - `Name` - название команды
  - `AdminId` - ID создателя (менеджера)
  - `TeamPassword` - пароль для вступления
  - `CreatedAt` - дата создания
  - `Members` - список участников
- Ограничения:
  - Создается только пользователем с ролью `Manager`
  - Нельзя удалить администратора
  - Пароль обязателен для вступления
- Генерируемые исключения:
  - `NoPermissionException`
  - `IncorrectPasswordExcepton`
  - `UserAlreadyExists`

Методы:
- `Create(name, password, admin)` - создание команды
- `AddMember(user, password)` - добавление участника
- `RemoveMember(user)` - удаление участника
- `IsMember(userId)` - проверка участия

---

### 👨‍💼 Manager (Менеджер)

- Специальная роль пользователя для управления командами
- Атрибуты:
  - `UserId` - ссылка на пользователя
  - `TeamId` - управляемая команда
- Ограничения:
  - Не может вступить в другие команды
- Генерируемые события:
  - `ManagerCreatedEvent` - при создании
  - `UserRemovedFromTeamEvent` - при удалении участника

Методы:
- `Create(user, team)` - создание менеджера
- `RemoveMemberOfTeams(user)` - удаление участника из команды

---

### ✅ Task (Задача)

- Основная рабочая единица системы
- Атрибуты:
  - `Title` - заголовок
  - `Description` - описание
  - `Status` - статус (`News`, `InProgress`, `Completed`)
  - `CreatedAt` - дата создания
  - `TeamId` - команда
  - `UserId` - создатель
- Связанные сущности:
  - `Comments` - комментарии к задаче
  - `Participants` - участники задачи
- Ограничения:
  - Обязателен заголовок
  - Максимум 10 комментариев

Методы:
- `Create(title, description, creator)` - создание задачи
- `AddComment(user, comment)` - добавление комментария
- `AssignTo(user, team)` - назначение на пользователя

---

## 🧪 Тестирование

### Тесты пользователя (`UserTest`)
- ✅ Успешное создание пользователя
- ✅ Ошибка при создании администратора
- ✅ Создание менеджера
- ✅ Выход из команды
- ✅ Ошибка выхода без команды

### Тесты команды (`TeamTest`)
- ✅ Создание с валидными данными
- ✅ Ошибка при невалидных данных
- ✅ Ошибка при создании не менеджером
- ✅ Добавление участника
- ✅ Ошибка при неверном пароле
- ✅ Удаление участника
- ✅ Защита администратора

### Тесты менеджера (`ManagerTest`)
- ✅ Создание менеджера
- ✅ Удаление участника команды

---

## ⚠️ Бизнес-правила

1. **Управление командами**:
   - Только `Manager` может создавать команды
   - Менеджер не может вступать в другие команды
   - Пароль обязателен для вступления

2. **Работа с задачами**:
   - Статусы изменяются по workflow
   - Ограничение на количество комментариев
   - Назначать можно только участникам команды

3. **Безопасность**:
   - Прямое создание `Admin` запрещено
   - Хэширование паролей (TODO)

---

## 🛠️ Технологии и подходы

- **Язык**: C# 10 / .NET 6+
- **Архитектура**: 
  - DDD (Domain-Driven Design)
  - Event Sourcing (Domain Events)
- **Тестирование**:
  - xUnit
  - FluentAssertions
- **Принципы**:
  - Инкапсуляция бизнес-логики
  - Явное определение ограничений
  - Неизменяемость где возможно

---

## 📌 Исключения

Кастомные исключения для бизнес-ошибок:

- `NoPermissionException` - нет прав
- `UserAlreadyExists` - дублирование
- `IncorrectPasswordExcepton` - неверный пароль
- `CommentOverflowException` - лимит комментариев

---

## 🚀 Дорожная карта

- [ ] Реализовать хеширование паролей
- [ ] Добавить историю изменений задач
- [ ] Интеграция с инфраструктурой
- [ ] Расширенная система ролей
- [ ] Уведомления о событиях

---

## ✍️ Автор

Учебный проект для освоения современных подходов к проектированию на .NET.